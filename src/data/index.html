<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Experimental HTTP Server</title>
    <script src="/static/crypto-js.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 40px 0;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #888;
            font-size: 1.1rem;
        }

        .methods-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .method-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .method-card:hover {
            transform: translateY(-5px);
            border-color: #00d4ff;
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.2);
        }

        .method-name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .method-name.get { color: #4ade80; }
        .method-name.post { color: #facc15; }
        .method-name.fetch { color: #00d4ff; }
        .method-name.info { color: #c084fc; }
        .method-name.ping { color: #fb7185; }
        .method-name.none { color: #f97316; }

        .method-desc {
            color: #aaa;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .demo-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 30px;
            margin-top: 30px;
        }

        h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #00d4ff;
        }

        h3 {
            font-size: 1.2rem;
            margin: 20px 0 15px;
            color: #888;
        }

        .demo-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        button:hover {
            transform: scale(1.05);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-get { background: #4ade80; color: #000; }
        .btn-post { background: #facc15; color: #000; }
        .btn-fetch { background: #00d4ff; color: #000; }
        .btn-info { background: #c084fc; color: #000; }
        .btn-ping { background: #fb7185; color: #000; }
        .btn-none { background: #f97316; color: #000; }
        .btn-download { background: #6366f1; color: #fff; }

        .response-area {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            word-break: break-all;
            min-height: 150px;
            max-height: 400px;
            overflow-y: auto;
        }

        .response-header {
            color: #7ee787;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #30363d;
        }

        .response-body {
            color: #c9d1d9;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        input[type="text"] {
            flex: 1;
            min-width: 200px;
            padding: 12px 16px;
            border: 1px solid #30363d;
            border-radius: 8px;
            background: #0d1117;
            color: #fff;
            font-size: 1rem;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #00d4ff;
        }

        footer {
            text-align: center;
            padding: 30px 0;
            color: #666;
            font-size: 0.9rem;
        }

        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-left: 10px;
        }

        .status.success { background: rgba(74, 222, 128, 0.2); color: #4ade80; }
        .status.error { background: rgba(248, 113, 113, 0.2); color: #f87171; }

        /* Upload section */
        .upload-section {
            background: rgba(249, 115, 22, 0.1);
            border: 2px dashed #f97316;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s ease;
        }

        .upload-section.dragover {
            background: rgba(249, 115, 22, 0.2);
            border-color: #fb923c;
        }

        .upload-section input[type="file"] {
            display: none;
        }

        .upload-label {
            display: block;
            cursor: pointer;
            padding: 20px;
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .upload-text {
            color: #aaa;
            margin-bottom: 10px;
        }

        .upload-hint {
            color: #666;
            font-size: 0.85rem;
        }

        .file-list {
            margin-top: 20px;
            text-align: left;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-name {
            color: #fff;
            font-weight: 500;
        }

        .file-size {
            color: #888;
            font-size: 0.85rem;
        }

        .file-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .file-status.pending { background: rgba(250, 204, 21, 0.2); color: #facc15; }
        .file-status.uploading { background: rgba(0, 212, 255, 0.2); color: #00d4ff; }
        .file-status.success { background: rgba(74, 222, 128, 0.2); color: #4ade80; }
        .file-status.error { background: rgba(248, 113, 113, 0.2); color: #f87171; }

        .uploaded-files {
            margin-top: 20px;
        }

        .uploaded-file {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(74, 222, 128, 0.1);
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid rgba(74, 222, 128, 0.3);
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 1px solid #30363d;
            padding-bottom: 10px;
        }

        .tab {
            padding: 10px 20px;
            background: transparent;
            border: 1px solid #30363d;
            color: #888;
            border-radius: 8px 8px 0 0;
        }

        .tab.active {
            background: rgba(0, 212, 255, 0.1);
            border-color: #00d4ff;
            color: #00d4ff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #30363d;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            transition: width 0.3s ease;
        }

        .method-btn {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .method-btn.active {
            opacity: 1;
            transform: scale(1);
            box-shadow: 0 0 10px currentColor;
        }

        .lang-switcher {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }

        .lang-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            width: 36px;
            height: 36px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lang-btn:hover {
            transform: scale(1.1);
            border-color: #00d4ff;
        }

        .lang-btn.active {
            border-color: #00d4ff;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }

        .telegram-link {
            color: #888;
            text-decoration: none;
            transition: color 0.2s ease;
            margin-top: 8px;
            display: inline-block;
        }

        .telegram-link:hover {
            color: #00d4ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Experimental HTTP Server</h1>
            <p class="subtitle" data-i18n="subtitle">HTTP-—Å–µ—Ä–≤–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤</p>
            <div class="lang-switcher">
                <button class="lang-btn active" onclick="setLang('ru')" id="langRu" title="–†—É—Å—Å–∫–∏–π">üá∑üá∫</button>
                <button class="lang-btn" onclick="setLang('en')" id="langEn" title="English">üá∫üá∏</button>
            </div>
            <p class="subtitle" id="sandboxIndicator" style="display: none; color: #f97316; margin-top: 10px; font-weight: bold;" data-i18n="sandboxMode">
                üîí SANDBOX MODE - –¥–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –ø–∞–ø–∫–æ–π uploads/
            </p>
        </header>

        <section class="methods-grid">
            <div class="method-card">
                <div class="method-name get">GET</div>
                <p class="method-desc" data-i18n="methodGet">–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤</p>
            </div>
            <div class="method-card">
                <div class="method-name post">POST</div>
                <p class="method-desc" data-i18n="methodPost">–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö</p>
            </div>
            <div class="method-card">
                <div class="method-name fetch">FETCH</div>
                <p class="method-desc" data-i18n="methodFetch">–°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤</p>
            </div>
            <div class="method-card">
                <div class="method-name info">INFO</div>
                <p class="method-desc" data-i18n="methodInfo">–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞</p>
            </div>
            <div class="method-card">
                <div class="method-name ping">PING</div>
                <p class="method-desc" data-i18n="methodPing">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞</p>
            </div>
            <div class="method-card">
                <div class="method-name none">NONE</div>
                <p class="method-desc" data-i18n="methodNone">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</p>
            </div>
        </section>

        <section class="demo-section">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('requests')" data-i18n="tabRequests">–ó–∞–ø—Ä–æ—Å—ã</button>
                <button class="tab" onclick="switchTab('upload')" data-i18n="tabUpload">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</button>
                <button class="tab" onclick="switchTab('opsec')">OPSEC Mode</button>
                <button class="tab" onclick="switchTab('files')" data-i18n="tabFiles">–§–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ</button>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ -->
            <div id="requests-tab" class="tab-content active">
                <h3 data-i18n="sendRequests">–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤</h3>

                <div class="input-group">
                    <input type="text" id="pathInput" data-i18n-placeholder="pathPlaceholder" placeholder="–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: /index.html)" value="/index.html">
                </div>

                <div class="demo-buttons">
                    <button class="btn-get" onclick="sendRequest('GET')">GET</button>
                    <button class="btn-fetch" onclick="sendRequest('FETCH')">FETCH</button>
                    <button class="btn-info" onclick="sendRequest('INFO')">INFO</button>
                    <button class="btn-ping" onclick="sendRequest('PING')">PING</button>
                </div>

                <div class="response-area" id="responseArea">
                    <div class="response-header">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞...</div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
            <div id="upload-tab" class="tab-content">
                <h3 data-i18n="uploadFiles">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</h3>

                <div class="demo-buttons" style="margin-bottom: 15px;">
                    <span style="color: #888; margin-right: 10px;" data-i18n="methodLabel">–ú–µ—Ç–æ–¥:</span>
                    <button class="btn-post method-btn" onclick="selectUploadMethod('POST')" id="methodPostBtn">POST</button>
                    <button class="btn-info method-btn" onclick="selectUploadMethod('PUT')" id="methodPutBtn" style="background: #8b5cf6;">PUT</button>
                    <button class="btn-none method-btn active" onclick="selectUploadMethod('NONE')" id="methodNoneBtn">NONE</button>
                </div>

                <div class="upload-section" id="dropZone">
                    <label class="upload-label" for="fileInput">
                        <div class="upload-icon">üìÅ</div>
                        <div class="upload-text" data-i18n="dropFilesHere">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</div>
                        <div class="upload-hint" id="uploadMethodHint" data-i18n="uploadMethodHint">–§–∞–π–ª—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ NONE</div>
                    </label>
                    <input type="file" id="fileInput" multiple>
                </div>

                <div class="file-list" id="fileList"></div>

                <div class="demo-buttons" style="margin-top: 20px;">
                    <button class="btn-none" onclick="uploadAllFiles()" id="uploadBtn" disabled data-i18n="uploadAllBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã</button>
                </div>

                <div class="response-area" id="uploadResponseArea">
                    <div class="response-header">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏...</div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ OPSEC -->
            <div id="opsec-tab" class="tab-content">
                <h3>OPSEC Mode - –°–∫—Ä—ã—Ç–∞—è –∑–∞–≥—Ä—É–∑–∫–∞</h3>
                <p style="color: #888; margin-bottom: 20px;">
                    –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –±–µ–∑ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –∏–º–µ–Ω–∏ –≤ URL/–∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–µ HTTP –º–µ—Ç–æ–¥—ã.
                </p>

                <div class="input-group">
                    <input type="text" id="opsecMethodInput" placeholder="HTTP –º–µ—Ç–æ–¥ (–ª—é–±–æ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä: CHECKDATA)" value="">
                    <button class="btn-info" onclick="generateRandomMethod()" style="background: #6366f1;">Random</button>
                </div>

                <div class="upload-section" id="opsecDropZone" style="border-color: #6366f1; background: rgba(99, 102, 241, 0.1);">
                    <label class="upload-label" for="opsecFileInput">
                        <div class="upload-icon">üîí</div>
                        <div class="upload-text">OPSEC Upload - –∏–º—è —Ñ–∞–π–ª–∞ —Å–∫—Ä—ã—Ç–æ</div>
                        <div class="upload-hint">–î–∞–Ω–Ω—ã–µ –∫–æ–¥–∏—Ä—É—é—Ç—Å—è –≤ base64, –ø—É—Ç—å –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞</div>
                    </label>
                    <input type="file" id="opsecFileInput">
                </div>

                <div class="input-group" style="margin-top: 15px;">
                    <label style="color: #888; margin-right: 10px;">
                        <input type="checkbox" id="opsecIncludeName"> –í–∫–ª—é—á–∏—Ç—å –∏–º—è —Ñ–∞–π–ª–∞ (–º–µ–Ω–µ–µ —Å–∫—Ä—ã—Ç–Ω–æ)
                    </label>
                </div>

                <div class="input-group" style="margin-top: 15px;">
                    <label style="color: #888; margin-right: 10px;">
                        <input type="checkbox" id="opsecEncrypt"> –®–∏—Ñ—Ä–æ–≤–∞—Ç—å XOR
                    </label>
                    <input type="password" id="opsecPassword" placeholder="–ü–∞—Ä–æ–ª—å –¥–ª—è XOR-—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è" style="flex: 1; padding: 10px; background: #0d1117; border: 1px solid #30363d; border-radius: 6px; color: #fff;" disabled>
                </div>

                <div class="input-group" style="margin-top: 10px; margin-left: 25px;">
                    <label style="color: #666; font-size: 0.9rem;">
                        <input type="checkbox" id="opsecSendKey"> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞)
                    </label>
                </div>

                <div class="input-group" style="margin-top: 5px; margin-left: 45px;">
                    <label style="color: #666; font-size: 0.85rem;">
                        <input type="checkbox" id="opsecKeyBase64" disabled> –ö–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á –≤ Base64
                    </label>
                </div>

                <div class="demo-buttons" style="margin-top: 20px;">
                    <button style="background: #6366f1; color: #fff;" onclick="opsecUpload()" id="opsecUploadBtn" disabled>
                        –ó–∞–≥—Ä—É–∑–∏—Ç—å (OPSEC)
                    </button>
                </div>

                <div class="response-area" id="opsecResponseArea">
                    <div class="response-header">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è —Å–∫—Ä—ã—Ç–æ–π –∑–∞–≥—Ä—É–∑–∫–∏...</div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ —Ñ–∞–π–ª–æ–≤ -->
            <div id="files-tab" class="tab-content">
                <h3 data-i18n="serverFiles">–§–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ</h3>

                <div class="input-group">
                    <button class="btn-fetch" onclick="goToRoot()" style="padding: 12px 16px;">/</button>
                    <button class="btn-ping" onclick="goUp()" style="padding: 12px 16px;">..</button>
                    <input type="text" id="browsePathInput" data-i18n-placeholder="dirPathPlaceholder" placeholder="–ü—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" value="/">
                    <button class="btn-info" onclick="browseDirectory()" data-i18n="browseBtn">–û–±–∑–æ—Ä (INFO)</button>
                </div>

                <div class="uploaded-files" id="serverFiles"></div>

                <div class="response-area" id="filesResponseArea">
                    <div class="response-header">–ù–∞–∂–º–∏—Ç–µ "–û–±–∑–æ—Ä" –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–∞–π–ª–æ–≤...</div>
                </div>
            </div>
        </section>

        <footer>
            <p>Experimental HTTP Server v2.0</p>
            <a href="https://t.me/kgmnotes" target="_blank" rel="noopener" id="telegramLink" class="telegram-link">
                @kgmnotes
            </a>
        </footer>
    </div>

    <script>
        // ===== –°–∏—Å—Ç–µ–º–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ =====
        const translations = {
            ru: {
                subtitle: "HTTP-—Å–µ—Ä–≤–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤",
                sandboxMode: "üîí SANDBOX MODE - –¥–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –ø–∞–ø–∫–æ–π uploads/",
                methodGet: "–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤",
                methodPost: "–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö",
                methodFetch: "–°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤",
                methodInfo: "–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞",
                methodPing: "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞",
                methodNone: "–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤",
                tabRequests: "–ó–∞–ø—Ä–æ—Å—ã",
                tabUpload: "–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤",
                tabFiles: "–§–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ",
                sendRequests: "–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤",
                pathPlaceholder: "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: /index.html)",
                uploadFiles: "–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤",
                methodLabel: "–ú–µ—Ç–æ–¥:",
                dropFilesHere: "–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞",
                uploadMethodHint: "–§–∞–π–ª—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ NONE",
                uploadAllBtn: "–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã",
                serverFiles: "–§–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ",
                dirPathPlaceholder: "–ü—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏",
                browseBtn: "–û–±–∑–æ—Ä (INFO)",
                statusPending: "–û–∂–∏–¥–∞–Ω–∏–µ",
                statusUploading: "–ó–∞–≥—Ä—É–∑–∫–∞...",
                statusSuccess: "–ó–∞–≥—Ä—É–∂–µ–Ω",
                statusError: "–û—à–∏–±–∫–∞",
                clickToSend: "–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞...",
                selectFilesToUpload: "–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏...",
                clickBrowse: "–ù–∞–∂–º–∏—Ç–µ \"–û–±–∑–æ—Ä\" –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–∞–π–ª–æ–≤...",
                uploadViaMethod: "–§–∞–π–ª—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥"
            },
            en: {
                subtitle: "HTTP server with custom method support",
                sandboxMode: "üîí SANDBOX MODE - access limited to uploads/ folder",
                methodGet: "Get resources",
                methodPost: "Send data",
                methodFetch: "Download files",
                methodInfo: "File metadata",
                methodPing: "Server check",
                methodNone: "Upload files",
                tabRequests: "Requests",
                tabUpload: "File Upload",
                tabFiles: "Server Files",
                sendRequests: "Send Requests",
                pathPlaceholder: "File path (e.g.: /index.html)",
                uploadFiles: "File Upload",
                methodLabel: "Method:",
                dropFilesHere: "Drag files here or click to select",
                uploadMethodHint: "Files will be uploaded via NONE method",
                uploadAllBtn: "Upload all files",
                serverFiles: "Server Files",
                dirPathPlaceholder: "Directory path",
                browseBtn: "Browse (INFO)",
                statusPending: "Pending",
                statusUploading: "Uploading...",
                statusSuccess: "Uploaded",
                statusError: "Error",
                clickToSend: "Click a button to send a request...",
                selectFilesToUpload: "Select files to upload...",
                clickBrowse: "Click \"Browse\" to view files...",
                uploadViaMethod: "Files will be uploaded via method"
            }
        };

        let currentLang = localStorage.getItem('lang') || 'ru';

        function setLang(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            applyTranslations();
            updateLangButtons();
        }

        function applyTranslations() {
            const t = translations[currentLang];

            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å data-i18n
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) {
                    el.textContent = t[key];
                }
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º placeholder'—ã
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (t[key]) {
                    el.placeholder = t[key];
                }
            });
        }

        function updateLangButtons() {
            document.getElementById('langRu').classList.toggle('active', currentLang === 'ru');
            document.getElementById('langEn').classList.toggle('active', currentLang === 'en');
        }

        function t(key) {
            return translations[currentLang][key] || key;
        }

        // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–≤–æ–¥—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            applyTranslations();
            updateLangButtons();
        });

        // –ë–∞–∑–æ–≤—ã–π URL —Å–µ—Ä–≤–µ—Ä–∞ (–µ—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –Ω–µ —Å –Ω–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)
        const SERVER_URL = window.location.port === '8080' ? '' : 'http://localhost:8080';

        // –§–∞–π–ª—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
        let filesToUpload = [];

        // Sandbox mode flag
        let isSandboxMode = false;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∂–∏–º —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        async function checkServerMode() {
            try {
                const response = await sendCustomRequest('PING', SERVER_URL + '/');
                const text = await response.text();
                const info = JSON.parse(text);

                if (info.sandbox_mode) {
                    isSandboxMode = true;
                    document.getElementById('sandboxIndicator').style.display = 'block';
                    // –í sandbox —Ä–µ–∂–∏–º–µ –Ω–∞—á–∏–Ω–∞–µ–º —Å –∫–æ—Ä–Ω—è (–∫–æ—Ç–æ—Ä—ã–π —Ç–µ–ø–µ—Ä—å uploads)
                    document.getElementById('browsePathInput').value = '/';
                }

                // –í OPSEC —Ä–µ–∂–∏–º–µ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–µ–ª–µ–≥—Ä–∞–º —É–¥–∞–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
            } catch (e) {
                console.log('Could not check server mode:', e);
            }
        }

        // –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        checkServerMode();

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // ===== –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ =====
        async function sendRequest(method) {
            const path = document.getElementById('pathInput').value || '/';
            const responseArea = document.getElementById('responseArea');

            responseArea.innerHTML = `<div class="response-header">–û—Ç–ø—Ä–∞–≤–∫–∞ ${method} –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ ${path}...</div>`;

            try {
                const startTime = performance.now();

                const response = await sendCustomRequest(method, SERVER_URL + path, null);

                const endTime = performance.now();
                const duration = (endTime - startTime).toFixed(2);

                const text = await response.text();
                const statusClass = response.status < 400 ? 'success' : 'error';

                let headersText = '';
                for (const [key, value] of Object.entries(response.headers)) {
                    headersText += `${key}: ${value}\n`;
                }

                let bodyDisplay = text;
                try {
                    const json = JSON.parse(text);
                    bodyDisplay = JSON.stringify(json, null, 2);
                } catch (e) {
                    if (text.length > 500) {
                        bodyDisplay = text.substring(0, 500) + '\n... (truncated)';
                    }
                }

                responseArea.innerHTML = `
<div class="response-header">
${method} ${path}
<span class="status ${statusClass}">${response.status} ${response.statusText || ''}</span>
–í—Ä–µ–º—è: ${duration}ms
</div>
<div class="response-body">--- –ó–∞–≥–æ–ª–æ–≤–∫–∏ ---
${headersText || '(–Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã)'}
--- –¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞ ---
${bodyDisplay}</div>`;

                // –ï—Å–ª–∏ —ç—Ç–æ FETCH, –ø—Ä–µ–¥–ª–æ–∂–∏–º —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª
                if (method === 'FETCH' && response.status === 200) {
                    const filename = response.headers['x-file-name'] || 'download';
                    responseArea.innerHTML += `\n\n<button class="btn-download" onclick="downloadFile('${path}')">–°–∫–∞—á–∞—Ç—å ${filename}</button>`;
                }

            } catch (error) {
                responseArea.innerHTML = `
<div class="response-header">
${method} ${path}
<span class="status error">–û—à–∏–±–∫–∞</span>
</div>
<div class="response-body">${error.message}</div>`;
            }
        }

        // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö HTTP-–º–µ—Ç–æ–¥–æ–≤
        function sendCustomRequest(method, path, body, headers = {}) {
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();
                xhr.open(method, path, true);
                xhr.timeout = 30000; // 30 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç

                for (const [key, value] of Object.entries(headers)) {
                    xhr.setRequestHeader(key, value);
                }

                xhr.onload = () => {
                    const responseHeaders = {};
                    xhr.getAllResponseHeaders().split('\r\n').forEach(line => {
                        const idx = line.indexOf(': ');
                        if (idx > 0) {
                            const key = line.substring(0, idx);
                            const value = line.substring(idx + 2);
                            responseHeaders[key.toLowerCase()] = value;
                        }
                    });
                    resolve({
                        status: xhr.status,
                        statusText: xhr.statusText,
                        headers: responseHeaders,
                        text: () => Promise.resolve(xhr.responseText),
                        blob: () => Promise.resolve(new Blob([xhr.response]))
                    });
                };

                xhr.onerror = () => reject(new Error('Network error - —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω'));
                xhr.ontimeout = () => reject(new Error('Timeout - –ø—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è'));

                if (body) {
                    xhr.send(body);
                } else if (method === 'POST') {
                    xhr.setRequestHeader('Content-Type', 'application/json');
                    xhr.send(JSON.stringify({ demo: true, timestamp: new Date().toISOString() }));
                } else {
                    xhr.send();
                }
            });
        }

        // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ FETCH
        async function downloadFile(path) {
            const xhr = new XMLHttpRequest();
            xhr.open('FETCH', SERVER_URL + path, true);
            xhr.responseType = 'blob';

            xhr.onload = () => {
                const filename = xhr.getResponseHeader('X-File-Name') || 'download';
                const blob = xhr.response;
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                a.remove();
            };

            xhr.send();
        }

        // ===== –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ =====
        let uploadMethod = 'NONE';  // –¢–µ–∫—É—â–∏–π –º–µ—Ç–æ–¥ –∑–∞–≥—Ä—É–∑–∫–∏

        function selectUploadMethod(method) {
            uploadMethod = method;

            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('.method-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`method${method === 'PUT' ? 'Put' : method.charAt(0) + method.slice(1).toLowerCase()}Btn`).classList.add('active');

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
            document.getElementById('uploadMethodHint').textContent = `${t('uploadViaMethod')} ${method}`;
        }

        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const uploadBtn = document.getElementById('uploadBtn');

        // Drag & Drop
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', () => {
            handleFiles(fileInput.files);
        });

        function handleFiles(files) {
            for (const file of files) {
                if (!filesToUpload.find(f => f.name === file.name && f.size === file.size)) {
                    filesToUpload.push({
                        file: file,
                        name: file.name,
                        size: file.size,
                        status: 'pending'
                    });
                }
            }
            renderFileList();
            uploadBtn.disabled = filesToUpload.length === 0;
        }

        function formatSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
            return (bytes / (1024 * 1024 * 1024)).toFixed(1) + ' GB';
        }

        function renderFileList() {
            fileList.innerHTML = filesToUpload.map((f, i) => `
                <div class="file-item">
                    <div class="file-info">
                        <span class="file-name">${f.name}</span>
                        <span class="file-size">${formatSize(f.size)}</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span class="file-status ${f.status}">${getStatusText(f.status)}</span>
                        ${f.status === 'pending' ? `<button onclick="removeFile(${i})" style="background: #f87171; padding: 5px 10px; font-size: 0.8rem;">‚úï</button>` : ''}
                    </div>
                </div>
                ${f.status === 'uploading' ? '<div class="progress-bar"><div class="progress-fill" style="width: 50%"></div></div>' : ''}
            `).join('');
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': t('statusPending'),
                'uploading': t('statusUploading'),
                'success': t('statusSuccess'),
                'error': t('statusError')
            };
            return statusMap[status] || status;
        }

        function removeFile(index) {
            filesToUpload.splice(index, 1);
            renderFileList();
            uploadBtn.disabled = filesToUpload.length === 0;
        }

        async function uploadAllFiles() {
            const uploadResponseArea = document.getElementById('uploadResponseArea');
            uploadResponseArea.innerHTML = '<div class="response-header">–ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É...</div>';
            uploadBtn.disabled = true;

            const results = [];

            for (let i = 0; i < filesToUpload.length; i++) {
                const fileData = filesToUpload[i];
                if (fileData.status !== 'pending') continue;

                fileData.status = 'uploading';
                renderFileList();

                try {
                    const arrayBuffer = await fileData.file.arrayBuffer();
                    console.log(`–ó–∞–≥—Ä—É–∑–∫–∞ ${fileData.name}, —Ä–∞–∑–º–µ—Ä: ${arrayBuffer.byteLength} –±–∞–π—Ç`);

                    // –ö–æ–¥–∏—Ä—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã)
                    const encodedFileName = encodeURIComponent(fileData.name);

                    const response = await sendCustomRequest(uploadMethod, SERVER_URL + '/' + encodedFileName, arrayBuffer, {
                        'Content-Type': fileData.file.type || 'application/octet-stream',
                        'X-File-Name': encodedFileName
                    });

                    console.log(`–û—Ç–≤–µ—Ç: ${response.status}`, response);

                    const text = await response.text();
                    console.log(`–¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞: ${text}`);

                    let result;
                    try {
                        result = JSON.parse(text);
                    } catch (parseError) {
                        result = { success: false, error: `–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞: ${text.substring(0, 100)}` };
                    }

                    if ((response.status === 200 || response.status === 201) && result.success) {
                        fileData.status = 'success';
                        fileData.serverPath = result.path;
                        results.push({ name: fileData.name, success: true, path: result.path });
                    } else {
                        fileData.status = 'error';
                        results.push({ name: fileData.name, success: false, error: result.error || `HTTP ${response.status}` });
                    }
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${fileData.name}:`, error);
                    fileData.status = 'error';
                    results.push({ name: fileData.name, success: false, error: error.message });
                }

                renderFileList();
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            const successCount = results.filter(r => r.success).length;
            const failCount = results.filter(r => !r.success).length;

            uploadResponseArea.innerHTML = `
<div class="response-header">
–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
<span class="status ${failCount === 0 ? 'success' : 'error'}">${successCount} —É—Å–ø–µ—à–Ω–æ, ${failCount} –æ—à–∏–±–æ–∫</span>
</div>
<div class="response-body">${results.map(r =>
    r.success
        ? `‚úì ${r.name} -> ${r.path}`
        : `‚úó ${r.name}: ${r.error}`
).join('\n')}</div>`;

            // –û—á–∏—â–∞–µ–º —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
            filesToUpload = filesToUpload.filter(f => f.status !== 'success');
            renderFileList();
            uploadBtn.disabled = filesToUpload.length === 0;
        }

        // ===== –û–±–∑–æ—Ä —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ =====
        function goToRoot() {
            document.getElementById('browsePathInput').value = '/';
            browseDirectory();
        }

        function goUp() {
            const pathInput = document.getElementById('browsePathInput');
            let path = pathInput.value || '/';

            // –£–±–∏—Ä–∞–µ–º trailing slash –µ—Å–ª–∏ –µ—Å—Ç—å
            if (path.endsWith('/') && path.length > 1) {
                path = path.slice(0, -1);
            }

            // –ù–∞—Ö–æ–¥–∏–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
            const lastSlash = path.lastIndexOf('/');
            if (lastSlash > 0) {
                path = path.substring(0, lastSlash);
            } else {
                path = '/';
            }

            pathInput.value = path;
            browseDirectory();
        }

        async function browseDirectory() {
            const path = document.getElementById('browsePathInput').value || '/';
            const filesResponseArea = document.getElementById('filesResponseArea');
            const serverFiles = document.getElementById('serverFiles');

            filesResponseArea.innerHTML = `<div class="response-header">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ ${path}...</div>`;

            try {
                const response = await sendCustomRequest('INFO', SERVER_URL + path);
                const text = await response.text();
                const info = JSON.parse(text);

                if (info.is_directory && info.contents) {
                    const basePath = path === '/' ? '' : path;
                    serverFiles.innerHTML = info.contents.map(item => {
                        const itemPath = (basePath + '/' + item.name).replace(/'/g, "\\'");
                        return `
                        <div class="uploaded-file">
                            <div class="file-info">
                                <span style="font-size: 1.2rem">${item.is_dir ? 'üìÅ' : 'üìÑ'}</span>
                                <span class="file-name">${item.name}</span>
                            </div>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                ${!item.is_dir ? `
                                    <button class="btn-info" onclick="getFileInfo('${itemPath}')" style="padding: 8px 12px; font-size: 0.85rem;">INFO</button>
                                    <button class="btn-fetch" onclick="downloadFile('${itemPath}')" style="padding: 8px 12px; font-size: 0.85rem;">FETCH</button>
                                    <button onclick="showSmuggleDialog('${itemPath}')" style="padding: 8px 12px; font-size: 0.85rem; background: #8b5cf6; color: #fff; border: none; border-radius: 8px; cursor: pointer;">SMUGGLE</button>
                                ` : `
                                    <button class="btn-info" onclick="document.getElementById('browsePathInput').value='${itemPath}'; browseDirectory();" style="padding: 8px 12px; font-size: 0.85rem;">–û—Ç–∫—Ä—ã—Ç—å</button>
                                `}
                            </div>
                        </div>
                    `}).join('');
                } else {
                    serverFiles.innerHTML = '';
                }

                const sandboxNote = info.sandbox_mode ? '\n--- SANDBOX MODE: –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ uploads/ ---\n' : '';
                filesResponseArea.innerHTML = `
<div class="response-header">
INFO ${path}
<span class="status success">200 OK</span>${info.sandbox_mode ? ' <span style="color: #f97316;">[SANDBOX]</span>' : ''}
</div>
<div class="response-body">${sandboxNote}${JSON.stringify(info, null, 2)}</div>`;

            } catch (error) {
                filesResponseArea.innerHTML = `
<div class="response-header">
INFO ${path}
<span class="status error">–û—à–∏–±–∫–∞</span>
</div>
<div class="response-body">${error.message}</div>`;
            }
        }

        async function getFileInfo(path) {
            document.getElementById('browsePathInput').value = path;
            await browseDirectory();
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
        document.querySelector('.tab:nth-child(4)').addEventListener('click', () => {
            setTimeout(browseDirectory, 100);
        });

        // ===== OPSEC Mode =====
        let opsecFile = null;
        const opsecFileInput = document.getElementById('opsecFileInput');
        const opsecUploadBtn = document.getElementById('opsecUploadBtn');
        const opsecDropZone = document.getElementById('opsecDropZone');
        const opsecEncryptCheckbox = document.getElementById('opsecEncrypt');
        const opsecPasswordInput = document.getElementById('opsecPassword');

        // Toggle password field when encryption checkbox changes
        opsecEncryptCheckbox.addEventListener('change', () => {
            opsecPasswordInput.disabled = !opsecEncryptCheckbox.checked;
            if (opsecEncryptCheckbox.checked) {
                opsecPasswordInput.focus();
            }
        });

        // Toggle base64 key checkbox when send key checkbox changes
        const opsecSendKeyCheckbox = document.getElementById('opsecSendKey');
        const opsecKeyBase64Checkbox = document.getElementById('opsecKeyBase64');
        opsecSendKeyCheckbox.addEventListener('change', () => {
            opsecKeyBase64Checkbox.disabled = !opsecSendKeyCheckbox.checked;
            if (!opsecSendKeyCheckbox.checked) {
                opsecKeyBase64Checkbox.checked = false;
            }
        });

        // XOR encryption function - uses UTF-8 encoding for password (matches Python)
        function xorEncrypt(data, password) {
            if (!password) return data;

            // Convert password to UTF-8 bytes (same as Python's .encode('utf-8'))
            const encoder = new TextEncoder();
            const keyBytes = encoder.encode(password);

            // XOR each byte with key
            const result = new Uint8Array(data.length);
            for (let i = 0; i < data.length; i++) {
                result[i] = data[i] ^ keyBytes[i % keyBytes.length];
            }
            return result;
        }

        // Random method names –¥–ª—è OPSEC
        const methodPrefixes = ['CHECK', 'SYNC', 'VERIFY', 'UPDATE', 'QUERY', 'REPORT', 'SUBMIT', 'VALIDATE', 'PROCESS', 'EXECUTE'];
        const methodSuffixes = ['DATA', 'STATUS', 'INFO', 'CONTENT', 'RESOURCE', 'ITEM', 'OBJECT', 'RECORD', 'ENTRY', ''];

        function generateRandomMethod() {
            const prefix = methodPrefixes[Math.floor(Math.random() * methodPrefixes.length)];
            const suffix = methodSuffixes[Math.floor(Math.random() * methodSuffixes.length)];
            const method = suffix ? `${prefix}${suffix}` : prefix;
            document.getElementById('opsecMethodInput').value = method;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã–º –º–µ—Ç–æ–¥–æ–º
        generateRandomMethod();

        opsecFileInput.addEventListener('change', () => {
            if (opsecFileInput.files.length > 0) {
                opsecFile = opsecFileInput.files[0];
                opsecUploadBtn.disabled = false;
                document.getElementById('opsecResponseArea').innerHTML = `
                    <div class="response-header">–§–∞–π–ª –≤—ã–±—Ä–∞–Ω: ${opsecFile.name} (${formatSize(opsecFile.size)})</div>
                `;
            }
        });

        opsecDropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            opsecDropZone.style.borderColor = '#818cf8';
        });

        opsecDropZone.addEventListener('dragleave', () => {
            opsecDropZone.style.borderColor = '#6366f1';
        });

        opsecDropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            opsecDropZone.style.borderColor = '#6366f1';
            if (e.dataTransfer.files.length > 0) {
                opsecFile = e.dataTransfer.files[0];
                opsecUploadBtn.disabled = false;
                document.getElementById('opsecResponseArea').innerHTML = `
                    <div class="response-header">–§–∞–π–ª –≤—ã–±—Ä–∞–Ω: ${opsecFile.name} (${formatSize(opsecFile.size)})</div>
                `;
            }
        });

        async function opsecUpload() {
            if (!opsecFile) return;

            const responseArea = document.getElementById('opsecResponseArea');
            const method = document.getElementById('opsecMethodInput').value || 'SYNCDATA';
            const includeName = document.getElementById('opsecIncludeName').checked;
            const useEncryption = opsecEncryptCheckbox.checked;
            const password = opsecPasswordInput.value;

            // Validate password if encryption is enabled
            if (useEncryption && !password) {
                responseArea.innerHTML = `<div class="response-header"><span class="status error">–û—à–∏–±–∫–∞: –≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</span></div>`;
                return;
            }

            responseArea.innerHTML = `<div class="response-header">–ó–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ ${method}${useEncryption ? ' (XOR —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ)' : ''}...</div>`;
            opsecUploadBtn.disabled = true;

            try {
                const arrayBuffer = await opsecFile.arrayBuffer();
                let dataBytes = new Uint8Array(arrayBuffer);

                // Apply XOR encryption if enabled
                if (useEncryption) {
                    dataBytes = xorEncrypt(dataBytes, password);
                    console.log(`[OPSEC] XOR encryption applied with password length: ${password.length}`);
                }

                const base64Data = btoa(String.fromCharCode(...dataBytes));

                // –§–æ—Ä–º–∏—Ä—É–µ–º payload - –∏–º—è —Ñ–∞–π–ª–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ checkbox –≤–∫–ª—é—á–µ–Ω
                const sendKeyToServer = document.getElementById('opsecSendKey').checked;
                const encodeKeyBase64 = document.getElementById('opsecKeyBase64').checked;
                const payload = {
                    d: base64Data
                };
                if (useEncryption) {
                    payload.e = 'xor';
                    if (sendKeyToServer) {
                        if (encodeKeyBase64) {
                            payload.k = btoa(unescape(encodeURIComponent(password)));  // Base64 UTF-8
                            payload.kb64 = true;  // –§–ª–∞–≥ —á—Ç–æ –∫–ª—é—á –≤ base64
                        } else {
                            payload.k = password;  // –ö–ª—é—á –∫–∞–∫ –µ—Å—Ç—å
                        }
                    }
                }
                if (includeName) {
                    payload.n = opsecFile.name;
                }

                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø—É—Ç—å (–Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞!)
                const randomPath = '/' + Math.random().toString(36).substring(2, 10);

                console.log(`[OPSEC] Method: ${method}, Path: ${randomPath}, Include name: ${includeName}`);

                const response = await sendCustomRequest(method, SERVER_URL + randomPath, JSON.stringify(payload), {
                    'Content-Type': 'application/json'
                });

                const text = await response.text();
                console.log(`[OPSEC] Response:`, text);

                let result;
                try {
                    result = JSON.parse(text);
                } catch (e) {
                    result = { ok: false, error: text };
                }

                if (result.ok) {
                    responseArea.innerHTML = `
<div class="response-header">
${method} ${randomPath}
<span class="status success">–ó–∞–≥—Ä—É–∂–µ–Ω–æ</span>
</div>
<div class="response-body">--- OPSEC Upload —É—Å–ø–µ—à–µ–Ω ---
ID: ${result.id}
–†–∞–∑–º–µ—Ä: ${result.sz} –±–∞–π—Ç

–ú–µ—Ç–æ–¥: ${method} (—Å–ª—É—á–∞–π–Ω—ã–π)
–ü—É—Ç—å: ${randomPath} (–Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–º—è —Ñ–∞–π–ª–∞)
–ò–º—è –≤ –∑–∞–ø—Ä–æ—Å–µ: ${includeName ? '–¥–∞' : '–Ω–µ—Ç (—Å–∫—Ä—ã—Ç–æ)'}
–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ: ${useEncryption ? (sendKeyToServer ? 'XOR (—Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ' + (encodeKeyBase64 ? ', –∫–ª—é—á –≤ base64' : '') + ')' : 'XOR (—Ñ–∞–π–ª –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω)') : '–Ω–µ—Ç'}
</div>`;
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π —Å–ª—É—á–∞–π–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–≥—Ä—É–∑–∫–∏
                    generateRandomMethod();
                } else {
                    responseArea.innerHTML = `
<div class="response-header">
${method} ${randomPath}
<span class="status error">–û—à–∏–±–∫–∞</span>
</div>
<div class="response-body">${result.error || 'Unknown error'}</div>`;
                }
            } catch (error) {
                console.error('[OPSEC] Error:', error);
                responseArea.innerHTML = `
<div class="response-header">
<span class="status error">–û—à–∏–±–∫–∞</span>
</div>
<div class="response-body">${error.message}</div>`;
            }

            opsecUploadBtn.disabled = false;
        }

        // ===== HTML Smuggling =====
        function showSmuggleDialog(filePath) {
            // –°–æ–∑–¥–∞—ë–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            const modal = document.createElement('div');
            modal.id = 'smuggleModal';
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000;">
                    <div style="background: #1a1a2e; padding: 30px; border-radius: 12px; max-width: 400px; width: 90%;">
                        <h3 style="color: #8b5cf6; margin-bottom: 15px;">HTML Smuggling</h3>
                        <p style="color: #888; margin-bottom: 15px; font-size: 0.9rem;">–§–∞–π–ª: ${filePath}</p>
                        <div style="margin-bottom: 15px;">
                            <label style="color: #888; font-size: 0.9rem;">
                                <input type="checkbox" id="smuggleEncrypt"> –ó–∞—â–∏—Ç–∏—Ç—å –ø–∞—Ä–æ–ª–µ–º (XOR)
                            </label>
                            <p style="color: #666; font-size: 0.8rem; margin-top: 5px;">–ü–∞—Ä–æ–ª—å –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Å–µ—Ä–≤–µ—Ä–æ–º</p>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button id="smuggleSubmitBtn" style="flex: 1; padding: 12px; background: #8b5cf6; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">–û—Ç–∫—Ä—ã—Ç—å</button>
                            <button id="smuggleCancelBtn" style="flex: 1; padding: 12px; background: #30363d; color: #fff; border: none; border-radius: 8px; cursor: pointer;">–û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
            document.getElementById('smuggleSubmitBtn').onclick = () => executeSmuggle(filePath);
            document.getElementById('smuggleCancelBtn').onclick = closeSmuggleDialog;
        }

        function closeSmuggleDialog() {
            const modal = document.getElementById('smuggleModal');
            if (modal) modal.remove();
        }

        async function executeSmuggle(filePath) {
            const usePassword = document.getElementById('smuggleEncrypt').checked;
            closeSmuggleDialog();

            // –§–æ—Ä–º–∏—Ä—É–µ–º URL
            let url = SERVER_URL + filePath;
            if (usePassword) {
                url += '?encrypt=1';  // –°–µ—Ä–≤–µ—Ä —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–∞—Ä–æ–ª—å
            }

            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ HTML —Ñ–∞–π–ª–∞
            try {
                const response = await sendCustomRequest('SMUGGLE', url);
                const text = await response.text();

                if (response.status === 200) {
                    const result = JSON.parse(text);

                    // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞–ø—Ä—è–º—É—é —Å —Å–µ—Ä–≤–µ—Ä–∞
                    window.open(SERVER_URL + result.url, '_blank');

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    const filesResponseArea = document.getElementById('filesResponseArea');
                    filesResponseArea.innerHTML = `
<div class="response-header">
SMUGGLE ${filePath}
<span class="status success">HTML —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω</span>
</div>
<div class="response-body">–§–∞–π–ª: ${result.file}
–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω: ${result.encrypted ? '–î–∞ (XOR)' : '–ù–µ—Ç'}
URL: ${result.url}

HTML —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ.</div>`;
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + text);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }
    </script>
</body>
</html>
